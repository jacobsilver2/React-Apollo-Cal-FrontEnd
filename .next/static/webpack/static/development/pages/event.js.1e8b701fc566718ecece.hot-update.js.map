{"version":3,"file":"static/webpack/static/development/pages/event.js.1e8b701fc566718ecece.hot-update.js","sources":["webpack:///./components/Calendar.js","webpack:///./components/CreateEvent.js"],"sourcesContent":["import React, { Component } from 'react';\nimport { Query } from 'react-apollo';\nimport gql from 'graphql-tag';\nimport {format, addDays, addMonths, subMonths, startOfWeek, endOfWeek, startOfMonth, endOfMonth, getMilliseconds, isSameDay, isSameMonth} from 'date-fns';\nimport {StyledCal} from './styles/CalendarStyles';\nimport CalendarEvent from './CalendarEvent';\nimport {CREATE_EVENT_MUTATION} from './CreateEvent';\n\nconst ALL_EVENTS_QUERY = gql`\n  query ALL_EVENTS_QUERY {\n    events {\n      id\n      title\n      description\n      image\n      largeImage\n      date\n    }\n  }\n`;\n\nclass Calendar extends Component {\n  state = { \n    currentMonth: new Date(),\n    selectedDate: new Date(),\n  };\n\n  renderHeader = () => {\n    const dateFormat = 'MMMM YYYY';\n    return (\n      <div className='header row flex-middle'>\n         <div className='col col-start'>\n             <div className='icon' onClick={this.prevMonth}>\n                 chevron_left\n             </div>\n         </div>\n         <div className='col col-center'>\n             <span>\n                 {format(this.state.currentMonth, dateFormat, { awareOfUnicodeTokens: true })}\n             </span>\n         </div>\n         <div className='col col-end' onClick={this.nextMonth}>\n             <div className=\"icon\">\n                chevron_right\n             </div>\n         </div>\n      </div>\n    )\n  }\n\n  renderDays = () => {\n    const dateFormat = 'EEEE';\n    const days = [];\n    let startDate = startOfWeek(this.state.currentMonth);\n\n    for (let i=0; i<7; i++) {\n        days.push(\n            <div className='col col-center' key={i}>\n               {format(addDays(startDate, i), dateFormat, {awareOfUnicodeTokens: true})}\n            </div>\n        );\n    }\n    return <div className=\"days row\">{days}</div>\n  }\n\n  renderCells = (events) => {\n    const { currentMonth, selectedDate } = this.state;\n    const monthStart = startOfMonth(currentMonth);\n    const monthEnd = endOfMonth(monthStart);\n    const startDate = startOfWeek(monthStart);\n    const endDate = endOfWeek(monthEnd);\n  \n    const dateFormat = \"d\";\n    const rows = [];\n    let days = [];\n    let day = startDate;\n    let formattedDate = \"\";\n    let dateCheckFormat = \"YYYY MMMM d\";\n    while (day <= endDate) {\n      for (let i = 0; i < 7; i++) {\n        formattedDate = format(day, dateFormat, { awareOfUnicodeTokens: true });\n        const matchedEvent = events.filter(event => isSameDay(event.date, day));\n        days.push(\n          <div\n            className={`col cell ${\n              !isSameMonth(day, monthStart)\n                ? \"disabled\"\n                : isSameDay(day, selectedDate) ? \"selected\" : \"\"\n            }`}\n            key={day.toString()}\n          >\n            <span className=\"number\">{formattedDate}</span>\n            <span className=\"bg\">{formattedDate}</span>\n            {matchedEvent.length > 0 && matchedEvent.map(e => <CalendarEvent event={e} key={e.id}/>)}\n          </div>\n        );\n        day = addDays(day, 1);\n    }\n  \n    rows.push(\n        <div className=\"row\" key={day}>\n          {days}\n        </div>\n      );\n      days = [];\n    }\n    return  <div className=\"body\">{rows}</div>;\n  }\n\n\nnextMonth = () => {\n  this.setState({\n      currentMonth: addMonths(this.state.currentMonth, 1)\n  })\n}\n\nprevMonth = () => {\n  this.setState({currentMonth: subMonths(this.state.currentMonth, 1)})\n}\n\n\n  render() {\n    return (\n\n        <Query query={ALL_EVENTS_QUERY}>\n          { ({data, error, loading}) => {\n            if (loading) return <p>Loading...</p>\n            if (error) return <p>Error: {error.message}</p>\n            return (\n              <StyledCal>\n                <div className=\"calendar\">\n                  {this.renderHeader()}\n                  {this.renderDays()}\n                  {this.renderCells(data.events)}\n                </div>\n              </StyledCal>\n            )\n          }}\n        </Query>\n\n    );\n  }\n}\n\nexport { ALL_EVENTS_QUERY };\nexport default Calendar;","import React, { Component } from 'react';\nimport { Mutation } from 'react-apollo';\nimport gql from 'graphql-tag';\nimport Router from 'next/router';\nimport Form from './styles/Form';\nimport Error from './ErrorMessage';\nimport { ALL_EVENTS_QUERY } from './Calendar'; \n\nconst CREATE_EVENT_MUTATION = gql`\n  mutation CREATE_EVENT_MUTATION(\n      $title: String!\n      $description: String\n      $image: String\n      $largeImage: String\n      $date: DateTime!\n  ) {\n    createEvent(\n      title: $title\n      description: $description\n      image: $image\n      largeImage: $largeImage\n      date: $date\n    ) {\n      id\n    }\n  }\n`;\n\nclass CreateEvent extends Component {\n  state = {\n    title: '',\n    description: '',\n    image: '',\n    largeImage: '',\n    date: '',\n  }\n\n  update = (cache, payload) => {\n    // manually update the cache on the client, so it matches the server\n\n    // 1. Read the events in the cache\n    const data = cache.readQuery({ query: ALL_EVENTS_QUERY })\n    \n    // 2. Add the new event to the events\n    data.events = data.events.push(payload.data);\n\n    // 3. Put the items back\n    cache.writeQuery( {query: ALL_EVENTS_QUERY, data });\n  }\n\n  handleChange = (e) => {\n    const { name, type, value } = e.target;\n    const val = type === 'number' ? parseFloat(value) : value;\n    this.setState({\n      [name]: val\n    })\n  }\n\n    uploadFile = async (e) => {\n    const files = e.target.files;\n    const data = new FormData();\n    data.append('file', files[0]);\n    data.append('upload_preset', 'react-apollo-cal');\n    const res = await fetch('https://api.cloudinary.com/v1_1/dlskxwzm6/image/upload', {\n      method: 'POST',\n      body: data\n    });\n    const file = await res.json();\n    console.log(file);\n    this.setState({\n      image: file.secure_url,\n      largeImage: file.eager[0].secure_url\n    })\n  }\n\n  render() {\n    return (\n      <Mutation mutation={CREATE_EVENT_MUTATION} update={this.update} variables={this.state}>\n        {(createEvent, { loading, error, called, data }) => (\n\n          <Form onSubmit={ async (e) => {\n            e.preventDefault();\n            const res = await createEvent();\n            Router.push({\n              pathname: '/'\n            })\n          }}>\n            <Error error={error} />\n\n            <fieldset disabled={loading} aria-busy={loading}>\n              <label htmlFor=\"file\">\n                Image\n                <input type=\"file\" id=\"file\" name=\"file\" placeholder=\"Upload an image\" onChange={this.uploadFile}/>\n                {this.state.image && <img src={this.state.image} alt=\"Upload Preview\" width=\"200\"/>}\n              </label>\n            \n              <label htmlFor=\"title\">\n                Title\n                <input type=\"text\" id=\"title\" name=\"title\" placeholder=\"Title\" required value={this.state.title} onChange={this.handleChange}/>\n              </label>\n        \n              <label htmlFor=\"date\">\n                Date\n                <input type=\"date\" id=\"date\" name=\"date\" placeholder=\"Date\" required value={this.state.date} onChange={this.handleChange}/>\n              </label>\n        \n              <label htmlFor=\"description\">\n                Description\n                <textarea id=\"description\" name=\"description\" placeholder=\"Enter A Description\" required value={this.state.description} onChange={this.handleChange}/>\n              </label>\n        \n              <button type=\"submit\">Submit</button>\n            </fieldset>\n          </Form>      \n        )}\n      </Mutation>\n    );\n  }\n}\n\nexport { CREATE_EVENT_MUTATION };\nexport default CreateEvent;"],"mappings":"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","sourceRoot":""}